function save(e){var a={};a.username=$("#username").val(),a.email=$("#email").val(),a.current_password=$("#curpassword").val(),a.new_password=$("#password").val(),a.confirm_new_password=$("#confirm_password").val(),a.api_key=$("#hidden_api_key").val(),a.id=e,a.role=parseInt($("#roles").val()),a.partner=parseInt($("#partner").val()),api.userId.post(a).success(function(e){successFlash("User updated successfully!"),dismiss(),location.reload()}).error(function(e){modalError(e.responseJSON.message)})}function edit(e){$("#modalSubmit").unbind("click").click(function(){save(e)}),api.userId.get(e).success(function(a){$("input[type=text], textarea").val(""),$("#username").val(a.username),$("#email").val(a.email),$("#hidden_hash").val(a.hash),$("#hidden_uid").val(a.id),$("#hidden_api_key").val(a.api_key);var t=a.partner;api.roles.get().success(function(e){$("#roles").find("option").each(function(e){""!==$(this).val()&&$(this).remove()}),$.each(e,function(e,a){$("#roles").append('<option value="'+a.rid+'" >'+a.name+"</option>")})}),api.rolesByUserId.get(e).success(function(e){$("#roles option").prop("selected",!1),$("#roles option[value="+e.rid+"]").prop("selected",!0),3!==e.rid&&4!==e.rid?$("#partner-container").css("display","none"):$("#partner-container").css("display","")}),api.users.partners().success(function(e){$("#partner").find("option").each(function(e){""!==$(this).val()&&$(this).remove()}),$.each(e,function(e,a){var o="";o=t==a.id?'selected = "selected"':"",$("#partner").append('<option value="'+a.id+'"  '+o+">"+a.username+"</option>")})}),$("#roles").change(function(){3==$(this).val()||4==$(this).val()?$("#partner-container").css("display",""):$("#partner-container").css("display","none")})})}function deleteUser(e){swal({title:"Are you sure?",text:"This will delete the user. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete ",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(a,t){api.userId.delete(e).success(function(e){a()}).error(function(e){t(e.responseJSON.message)})})}}).then(function(){swal("User Deleted!","This user has been deleted!","success"),$('button:contains("OK")').on("click",function(){location.reload()})})}function dismiss(){$("#modal\\.flashes").empty(),$("#username").val(""),$("#email").val(""),$("#curpassword").val(""),$("#password").val(""),$("#confirm_password").val(""),$("#partner").val(""),$("#roles").val(""),$("#modal").modal("hide")}var labels={"In progress":"label-primary",Queued:"label-info",Completed:"label-success","Emails Sent":"label-success",Error:"label-danger"},campaigns=[],campaign={};$(document).ready(function(){$("#launch_date").datetimepicker({widgetPositioning:{vertical:"bottom"},showTodayButton:!0,defaultDate:moment()}),$("#send_by_date").datetimepicker({widgetPositioning:{vertical:"bottom"},showTodayButton:!0,useCurrent:!1}),$(".modal").on("hidden.bs.modal",function(e){$(this).removeClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")-1)}),$(".modal").on("shown.bs.modal",function(e){void 0===$("body").data("fv_open_modals")&&$("body").data("fv_open_modals",0),$(this).hasClass("fv-modal-stack")||($(this).addClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")+1),$(this).css("z-index",1040+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not(".fv-modal-stack").css("z-index",1039+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not("fv-modal-stack").addClass("fv-modal-stack"))}),$(document).on("hidden.bs.modal",".modal",function(){$(".modal:visible").length&&$(document.body).addClass("modal-open")}),$("#modal").on("hidden.bs.modal",function(e){dismiss()}),api.users.get().success(function(e){people=e,$("#loading").hide(),people.length>0?($("#peopleTable").show(),peopleTable=$("#peopleTable").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[0,"asc"]]}),$.each(people,function(e,a){peopleTable.row.add([a.username,a.email,a.role,"<div class='pull-right'><span data-toggle='modal' data-backdrop='static' data-target='#modal'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='' onclick='edit("+a.id+")' data-original-title='Edit Page'>  <i class='fa fa-pencil'></i> </button> </span>  <span data-backdrop='static' data-target='#modal'><button class='btn btn-danger' onclick='deleteUser("+a.id+")' data-toggle='tooltip' data-placement='left' title='Delete User'> <i class='fa fa-trash-o'></i></button></span></div>"]).draw()})):$("#emptyMessage").show()}).error(function(){$("#loading").hide(),errorFlash("Error fetching peoples")}),$.fn.select2.defaults.set("width","100%"),$.fn.select2.defaults.set("dropdownParent",$("#modal_body")),$.fn.select2.defaults.set("theme","bootstrap"),$.fn.select2.defaults.set("sorter",function(e){return e.sort(function(e,a){return e.text.toLowerCase()>a.text.toLowerCase()?1:e.text.toLowerCase()<a.text.toLowerCase()?-1:0})})});